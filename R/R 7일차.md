# R 7일차

## 1. 통계 지식 활용

### 1. 기술 통계량과 빈도 분석

- **기술 통계량**(Descriptive Statistics)
  - 자료를 요약하는 기초적인 통계량으로 데이터 분석 전에 전체적인 데이터 분포의 이해와 통계적 수치를 제공
  - 모집단의 특성을 유추하는데 이용할 수 있다
  - 설문조사를 시행한 논문에서는 응답자의 일반적인 특성을 반드시 제시하여야 한다.
  - 논문에서는 “표분의 일반적 특성” 또는 “표본의 인구 통계적 특성”으로 표현한다.
  - 인구 통계적 특성을 제시하는데 주로 이용되는 분석 : 빈도분석과 기초통계량

- **빈도 분석** (Frequence Analysis)
  - 설문조자 결과에 대한 가장 기초적인 정보를 제공해주는 분석 방법으로 광범위하게 이용된다.
  - 성별이나 직급을 수치화하는 명목척도나 서열척도 같은 범주형 데이터를 대상으로 비율을 측정하는데 주로 사용된다
    - 예) 전체 응답자 중에서 특정 변수값의 범주에 속한 응답자가 차지하는 비율(%)을 알아보고자 할때 주로 이용 – 특정 선거 후보가 얼마만큼의 지지율(%)을 받고 있는가? 응답자 중에서 남자의 비율(%)과 여자의 비율(%)은 ? 연령대별로 차지하는 비율(%)

### 2. 실습

```R
getwd()
data <- read.csv("./data/descriptive.csv", header=TRUE)
head(data)
str(data)     #8개변수(컬럼), 300개의 관측치
#resident(거주지역)
#gender(성별 - 명목(1,2))
#level(학력수준-서열1,2,3)
#cost(생활비-비율)
#type(학교유형-명목 1, 2)
#survey(만족도 -등간척도 5점)
#pass(합격여부- 명목 1, 2)

dim(data)
length(data) #변수 개수 (컬럼개수)
length(data$survey)   #관측치 개수 (행개수)

fivenum(data)
summary(data)  #컬럼단위로 최소값, 최대값, 평균, 1,3 분위수, 결측치, 중앙값(중위수) 등 제공
```

## 2. 명목 척도 기술 통계량

### 1. 단계

- **명목 척도 기술 통계량**(Descriptive Statistics)
  - 단계1] 전체 데이터 셋의 분포와 특성을 분석
  - 단계2] 결측치, 이상치 등 데이터 정제
  - 단계3] 척도별 기술 통계량을 구함



- 명목상 의미 없는 수치로 표현된 거주지역이나 성별과 같은 명목척도 변수를 대상으로 기초 통계량을 구한다.

- summary() 로 계산된 최대값, 최소값, 평균 등의 요약 통계량은 의미가 없다.

- 성별의 구성비율은 표본의 통계량으로 의미가 있다.

### 2. 실습

```R
#명목척도의 기술 통계량 - 결측치 제거 -> 빈도수 - >비율 ->백분률 
length(data$gender)  #관측치 확인
summary(data$gender)  #명목척도는 최소값, 최대값, 평균등 의미없음

table(data$gender) #각 성별의 빈도수

data <- subset(data, data$gender==1 | data$gender=2)
x <- table(data$gender)  #빈도수에 따른 분할표
barplot(x)  #범주별 데이터 시각화 -> 막대 차트

y <- prop.table(x) #비율 계산
round(y*100, 2)    #백분률로 변환
```

## 3. 서열 척도 기술 통계량

### 1. 개념

- **서열 척도 기술 통계량**(Descriptive Statistics) 
  - 계급 순위를 수치로  표현한 직급이나 학력 수준 등 서열척도 변수를  대상으로 기초 통계량을 구한다.
  - summary() 로 계산된 최대값, 최소값, 평균 등의 요약 통계량은 의미가 없다.
  - table() 함수에 의해서 구해진 빈도수를 통해서 표본의  통계량을 산출한다.

### 2. 실습

```R
#########서열 척도 기술 통계량
data <- read.csv("./data/descriptive.csv", header=TRUE)
summary(data$level)  #명목척도는 최소값, 최대값, 평균등 의미없음
table(data$level)  #고졸(1), 대졸(2), 대학원(3)  의 빈도수에 따른 분할표

x1<- table(data$level) 
barplot(x1)

y1 <- prop.table(x1) #비율 계산
round(y1*100, 2)    #백분률로 변환
```

## 4.  등간 척도 기술 통계량

### 1. 개념

- 속성의 간격이 일정한 값을 갖는 변수
  - 예) 귀하는 교육시설에 만족하십니까? ① 매우만족  ② 만족  ③ 보통  ④ 불만족  ⑤ 매우 불만족
  - 응답을 얻어 가중치를 적용하여 가감산하거나 역코딩하여 총득점으로 응답자의 생각을 측정하는 방법

### 2. 실습

```R
survey <- data$survey
survey
summary(survey) #등간척도에서 평균 통계량은 어느 정도 의미가 있다고 볼 수 있습니다.

x2 <- table(survey)   #빈도수는 의미 있음
hist(survey)   #등간척도 시각화(히스토그램)
pie(x2)  #빈도수를 이용한 시각화 - 파이 차트
```



## 5. 비율 척도 기술 통계량

### 1. 개념

- 등간척도의 특성에 절대원점(0)이 존재하는 척도

- 응답자가 직접 수치를 입력한 변수
- 속성이 0을 기준으로 한 수치로 되어 있기 때문에 사칙연산이 모두 가능한 변수
- 빈도분석과 기술 통계량 등 가장 많은 표본의 통계량을 얻을 수 있다.
- 평균이 극단치에 영향을 받는 경우는 중위수(median)로 대체하는 것이 더 효과적이다.



- **대표값** 
  - 자료 전체를 대표하는 값으로 분포의 중심위치를 나타내는 평균, 중위수, 사분위수, 최빈수 등의 통계를 의미한다

- **사분위수**
  - 전체 데이터의 크기를 네 등분하여 나타낸 통계량
  - 1사분위수는 누적 백분율 25%에 해당
  - 2사분위수는 누적 백분율 50%에 해당
  - 3사분위수는 누적 백분율 75%에 해당
  - 4사분위수는 누적 백분율 100%에 해당

### 2. 실습

```R
length(data$cost)
summary(data$cost)   #요약 통계 - 의미 있음

plot(data$cost)   # 이상치 발견
data <- subset(data, data$cost >=2 & data$cost <= 10)
x3<-data$cost
mean(x3)
median(x3)  #평균이 극단치에 영향을 받는 경우 중위수로 대체하는 것이 더 효과적입니다.

A반 성적 = 75,80,80,80,85    평균=80 중위수=80
B반 성적 = 75,75,75,75,100   평균=80 중위수=75

quantile(x3, 1/4)  # 1사분위수
quantile(x3, 2/4)  #중앙값과 동일
quantile(x3, 3/4)   #
quantile(x3, 4/4)

#최빈수 - 빈도수가 가장 많은 변량  
x3.t <- table(x3)   #빈도수
max(table(x3) )

x3.m <- rbind(x3.t)
x3.m

class(x3.m)
str(x3.m)
x3.df <- as.data.frame(x3.m)
which(x3.df[1,]==18)
x3.df[1, 19]
names(x3.df[19])
```



## 6. 산포도

### 1. 개념

- 자료가 대표값으로부터 얼마나 흩어져 분포하고 있는가의 정도를 나타내는 척도



## 7. 비율척도의 빈도 분석

### 1. 개념

- 비율척도 변수의 값은 응답자가 직접 입력하는 수치이기 때문에 동일한 수치의 빈도수를 나타내는  table()함수의 수행 결과는 의미가 없다고 볼 수 있다.

- 빈도 분석에 의미를 두기 위해서는 일정한 간격으로 범주화하는 리코딩 과정이 필요하다. 

- 연속형 변수는 히스토그램이나 산점도 등으로 시각화하는 것이 효과적이다.

### 2. 실습

```R
##########비율척도의 빈도 분석 : 비율척도를 범주화 (리코딩)
table(data$cost)
hist(data$cost)
plot(data$cost)


#연속형 변수 범주화
data$cost2[data$cost >=1 & data$cost<=3] <- 1
data$cost2[data$cost >=4 & data$cost<=6] <- 2
data$cost2[data$cost >=7 ] <- 3

table(data$cost2)
barplot(table(data$cost2))
pie(table(data$cost2))


##########정규 분포를 갖는지 확인 - 왜도, 첨도 
install.packages("moments" )   #moments 패키지
library(moments)
cost <- data$cost
result <- cost[!is.na(cost)]
result
skewness(result)  #왜도 반환  0보다 크면  , 0보다 작으면 ....
kurtosis(result)   #첨도 반환 (정규분포의 첨도는 3)
hist(result)
hist(result, freq=F) #히스토그램의 계급을 확률 밀도로 표현
lines(density(result), col='blue')  #cost의 밀도 분포 곡선
x<-seq(0, 8, 0.1)   #0~8범위의 0.1씩 증가하는 데이터 벡터 생성
curve(dnorm(x, mean(result), sd(result)), col='red', add=T)  #정규분포 확률 밀도
```

## 8. attach()/detach() 함수 

```R
#######attach()/detach() 함수 
리스트객체$key, dataframe객체$컬럼변수
attach()함수는 dataframe객체$컬럼변수로부터  dataframe객체 데이터셋 이름을 생략하고 컬럼변수만으로 관측치에 사용가능
detach()함수는  dataframe객체$컬럼변수로 관측치에 접근

data <- read.csv("./data/descriptive.csv", header=TRUE)
data$survey
data$cost
attach(data)   # '데이터셋$' 생략할 수 있도록 설정
length(cost)   # na.rm옵션
summary(cost)
mean(cost, na.rm=T) 
min(cost, na.rm=T)
range(cost, na.rm=T)
sort(cost, decreasing=T)
detach(data)    # '데이터셋$' 생략할 수 없도록 설정, attach() 해제
length(pass)   #오류?
length(data$pass)
```



## 9. 패키지

### 1. Hmisc 패키지

```R
#########Hmisc 패키지
install.packages("Hmisc")
library(Hmisc)
describe(data)
```

### 2. prettyR 패키지
```R
############prettyR 패키지
install.packages("prettyR")
library(prettyR)
freq(data)

Quiz> 거주지역 변수 리코딩 후 비율 계산
범주화 : 1은 특별시  , 2~4 광역시, 5는 시군구   
빈도수, 비율, 백분율


Quiz> 성별 변수 리코딩 후 비율 계산
범주화 : 1은 남자  , 2은 여자
빈도수, 비율, 백분율


Quiz> 나이변수 리코딩 후 비율 계산
범주화 : <=45 중년층,  46~59는 장년층, >=60 노년층
빈도수, 비율, 백분율
```



## 10. 샘플 추출

```R
# 벡터 데이터 1~10 로부터 5개 샘플 추출 복원 추출
sample(1:10, 5, replace=TRUE)

# 벡터 데이터 1~10 로부터 5개 샘플 추출 비복원 추출
sample(1:10, 5)

install.packages("sampling")
library(sampling)
head(iris)
result <- strata(c("Species"), size=c(3,3,3) , method="srswor", data=iris))
# srswor : 비복원 단순 임의 추출
# srswr : 복원 단순 임의 추출
# poisson : 포아송 추출
# systematic : 계통 추출

result
getdata(iris, result)


#계통추출 
install.packages("doBy")
library(doBy)
x <- data.frame(x=1:10)
sampleBy(~1, frac=.3, data=x, systematic=TRUE)


d <- data.frame(x=c("1", "2", "2", "1"),  y=c("A", "B", "A", "B"),   num=c(3, 5, 8, 7))
xt <- xtabs(num ~ x + y, data=d)   #분할표 생성
xt
margin.table(xt, 1)  # 3 + 7 = 10, 8 + 5 = 13
margin.table(xt, 2)  # 3 + 8 = 11, 7 + 5 = 12
margin.table(xt)     # 3 + 7 + 8 + 5 = 23
 

prop.table(xt, 1)  #  3/10, 7/10
                      8/13, 5/13
prop.table(xt, 2)  #  3/11, 7/12
                      8/11, 5/12

prop.table(xt)     #  3/23, 7/23
                      8/23, 5/23
```

## 11. 교차분석을 위한 변수 모델링

```R
data <- read.csv("./data/cleanDescriptive.csv", header=TRUE)
data
str(data)

#부모의 학력수준이 자녀의 대학진학 여부와 관련이 있는지를 분석하기 위해
학력수준 변수는 독립변수
대학진학 여부 변수는 종속변수
x<- data$level2  
y<- data$pass2

result <- data.frame(Level=x, Pass=y)
dim(result)

#교차분석을 위한 분할표 생성
table(result)

install.packages("gmodels")
library(gmodels)
library(ggplot2)
CrossTable(x=result$Level, y=result$Pass)
head(diamonds)
str(diamonds)  
# 5만4천개의 다이아몬드 속성 데이터 셋
#price, carat, cut(커팅품질), color, clarity(선명도),....
CrossTable(x=diamonds$color, y=diamonds$cut)


##############################################################
부모의 학력수준과 자녀의 진학여부와 관련성이 있는지 독립성 검정 
##############################################################
연구가설(H1) :  부모의 학력수준과 자녀의 진학여부와 관련성 있다
귀무가설(H0) : 부모의 학력수준과 자녀의 진학여부와 관련성이 없다

str(data)

#부모의 학력수준이 자녀의 대학진학 여부와 관련이 있는지를 분석하기 위해
학력수준 변수는 독립변수
대학진학 여부 변수는 종속변수
x<- data$level2  
y<- data$pass2

result <- data.frame(Level=x, Pass=y)
CrossTable(x=result$Level, y=result$Pass)

#이원카이제곱 검정
chisq.test(x=result$Level, y=result$Pass)

해석 : 
유의확률(p-value) 0.2507 이 유의수준(α= 0.05) 보다 크므로 귀무가설 채택
부모의 학력수준과 자녀의 진학여부와 관련성이 없다

카이제곱 검정통계량 : 2.767, 자유도 : 2
임계값 : 5.99, 기각값(X^2 >= 5.99) 이면 귀무가설을 기각할 수 있다  
X^2= 2.767 < 5.99 이므로 귀무가설을 기각 할 수 없다

```

## 12. 선호도 검정 : 일원 카이제곱 검정, 한 개의 변인(집단 또는 범주)를 대상으로 검정

### 1. 개념 정리

- 귀무가설 : 기대치와 관찰치는 차이가 없다   예) 스포츠음료에 대한 선호도에 차이가 없다
- 대립가설 : 기대치와 관찰치는 차이가 있다.  예) 스포츠음료에 대한 선호도에 차이가 있다

### 2. 실습

```R
data <- textConnection("스포츠음료종류   관측도수
                     1  41
                     2  30
                     3  51
                     4  71
                     5  61")
x <- read.table(data, header=T)
x
str(x)
chisq.test(x$관측도수)


해석 : 
유의확률(p-value)  0.0003999 이 유의수준(α= 0.05) 보다 작으므로 귀무가설을 기각할 수 있다
연구가설 채택 됨 (스포츠음료에 대한 선호도에 차이가 있다)

카이제곱검정통계량 20.88 > 9.49 귀무가설을 기각할 수 있다.
```

